{% extends 'folios/base.html' %}

{% block title %}Editar Folio {{ f.numero_folio }}{% endblock %}

{% block content %}
<h4 class="mb-3">Editar Folio <span class="text-primary">{{ f.numero_folio }}</span></h4>

{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  {% endfor %}
{% endif %}

<div class="card shadow rounded-4">
  <div class="card-body p-4">
    <form method="post">
      {% csrf_token %}

      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label">RFC</label>
          <input type="text" name="rfc" class="form-control form-control-lg" maxlength="13" value="{{ form.rfc }}" required>
        </div>
        <div class="col-md-8">
          <label class="form-label">Resolución</label>
          <input type="text" name="resolucion" class="form-control form-control-lg" value="{{ form.resolucion }}" required>
        </div>

        <div class="col-md-4">
          <label class="form-label">Contribuyente</label>
          <input type="text" name="contribuyente" class="form-control form-control-lg" value="{{ form.contribuyente }}" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Dependencia</label>
          <input type="text" name="dependencia" class="form-control form-control-lg" value="{{ form.dependencia }}" required>
        </div>
        <div class="col-md-4">
          <label class="form-label">Tema</label>
          <select name="tema" class="form-select form-select-lg" required>
            {% for t in temas %}
              <option value="{{ t.id }}" {% if form.tema_id == t.id|stringformat:'s' %}selected{% endif %}>{{ t.nombre }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-12">
          <label class="form-label">Motivo</label>
          <textarea name="motivo" class="form-control form-control-lg" rows="3" required>{{ form.motivo }}</textarea>
        </div>

        <div class="col-md-4">
          <label class="form-label">Tipo de firmado</label>
          <select name="tipo_firmado" class="form-select form-select-lg" required>
            <option value="AUTOGRAFO" {% if form.tipo_firmado == 'AUTOGRAFO' %}selected{% endif %}>Autógrafo</option>
            <option value="SIFEN" {% if form.tipo_firmado == 'SIFEN' %}selected{% endif %}>Sifen</option>
          </select>
        </div>

        {% if es_admin %}
          <div class="col-md-4">
            <label class="form-label">Estatus</label>
            <select name="estatus" class="form-select form-select-lg">
              <option value="PENDIENTE" {% if form.estatus == 'PENDIENTE' %}selected{% endif %}>Pendiente</option>
              <option value="CONCLUIDO" {% if form.estatus == 'CONCLUIDO' %}selected{% endif %}>Concluido</option>
            </select>
          </div>
        {% else %}
          <!-- Para no-admin, mostramos estatus solo lectura -->
          <div class="col-md-4">
            <label class="form-label">Estatus</label>
            <input class="form-control form-control-lg" value="{% if form.estatus == 'PENDIENTE' %}Pendiente{% else %}Concluido{% endif %}" disabled>
          </div>
        {% endif %}
      </div>

      <div class="d-flex gap-2 mt-4">
        <button class="btn btn-primary btn-lg" type="submit">Guardar cambios</button>
        <a class="btn btn-outline-secondary btn-lg" href="{% url 'folios_consulta' %}">Cancelar</a>
      </div>
    </form>
  </div>
</div>
{% endblock %}
